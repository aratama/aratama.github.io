<!DOCTYPE html>
<meta charset="UTF-8">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="実例によるPureScript">
  <meta name="twitter:description" content="純粋関数型プログラミング言語 PureScriptの入門書、&quot;PureScript by Example&quot;の日本語訳">
  <meta name="twitter:いまげ" content="http://aratama.github.io/purescript/card.png">    
  <meta property="og:url" content="http://aratama.github.io/purescript/">
  <meta property="og:title" content="実例によるPureScript">
  <meta property="og:description" content="純粋関数型プログラミング言語 PureScriptの入門書、&quot;PureScript by Example&quot;の日本語訳">
  <meta property="og:image" content="http://aratama.github.io/purescript/card.png">
  
  <title>実例によるPureScript</title>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96">
  <link rel="stylesheet" href="github-markdown.css" type="text/css"/>
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto"/>
  <link rel="stylesheet" href="style.css"/>



</head>

<body>
  <div class="main">
    <header>
      <a class="logo" href="/purescript/">
          <img class="logo" src="logo-shadow.png">
      </a>
      <div class="title">
          <h1 id="実例によるpurescript">実例による<wbr>PureScript</h1>
          <p>ウェブのための<wbr>関数型<wbr>プログラミング</p>
          <p class="author">
            <a href="https://leanpub.com/purescript/read">
              Phil Freeman, &quot;PureScript by Example - Functional Programming for the Web&quot;
            </a>
          </p>
      </div>
    </header>

    <div class="markdown-body content">
<p class="home">
<a href="index.html">&lt; 目次に戻る</a>
</p>
<h1 id="開発環境の準備"><span class="header-section-number">2</span> 開発環境の準備</h1>
<h2 id="この章の目標"><span class="header-section-number">2.1</span> この章の目標</h2>
<p>この章の目標は、作業用のPureScript開発環境を準備し、最初のPureScriptプログラムを書くことです。</p>
<p>これから書く最初のコードはごく単純なPureScriptライブラリで、直角三角形の対角線の長さを計算する関数ひとつだけを提供します。</p>
<h2 id="導入"><span class="header-section-number">2.2</span> 導入</h2>
<p>PureScript開発環境を準備するために、次のツールを使います。</p>
<ul>
<li><a href="http://purescript.org"><code>purs</code></a> - PureScriptコンパイラ本体</li>
<li><a href="http://npmjs.org"><code>npm</code></a> - 残りの開発ツールをインストールできるようにする、Nodeパッケージマネージャ</li>
<li><a href="https://github.com/purescript-contrib/pulp"><code>Pulp</code></a> ​​- さまざまな作業をパッケージマネージャと連動して自動化するコマンドラインツール</li>
</ul>
<p>この章ではこれらのツールのインストール方法と設定を説明します。</p>
<h2 id="purescriptのインストール"><span class="header-section-number">2.3</span> PureScriptのインストール</h2>
<p>PureScriptコンパイラをインストールするときにお勧めなのは、<a href="http://purescript.org">PureScriptのウェブサイト</a>からバイナリディストリビューションとしてダウンロードする方法です。 PureScriptコンパイラおよび関連する実行ファイルがパス上で利用できるかどうか確認をしてください。確認のために、コマンドラインでPureScriptコンパイラを実行してみましょう。</p>
<pre class="text"><code>$ purs</code></pre>
<p>PureScriptコンパイラをインストールする他の選択肢としては、次のようなものがあります。</p>
<ul>
<li>NPMを使用する: <code>npm install -g purescript</code></li>
<li>ソースコードからコンパイルを行う。この方法については、PureScriptのWebサイトが参考になります</li>
</ul>
<h2 id="各ツールのインストール"><span class="header-section-number">2.4</span> 各ツールのインストール</h2>
<p>もし<a href="http://nodejs.org/">NodeJS</a>がインストールされていないなら、NodeJSをインストールする必要があります。そうするとシステムに <code>npm</code>パッケージマネージャもインストールされるはずです。 <code>npm</code>がインストールされ、パス上で利用可能であることを確認してください。</p>
<p><code>npm</code>がインストールされたら、 <code>pulp</code>と <code>bower</code>もインストールする必要があります。プロジェクトがどこで作業しているかにかかわらずこれらのコマンドラインツールを利用可能にするため、通常はグローバルにインストールしておくのがいいでしょう。</p>
<pre class="text"><code>$ npm install -g pulp bower</code></pre>
<p>これで、最初のPureScriptプロジェクトを作成するために必要なすべてのツールの用意ができたことになります。</p>
<h2 id="hello-purescript"><span class="header-section-number">2.5</span> Hello, PureScript!</h2>
<p>まずはシンプルに始めましょう。PureScriptコンパイラ <code>pulp</code>を直接使用して、基本的なHello World! プログラムをコンパイルします。 まず最初に、空のディレクトリ <code>my-project</code>を作成し、そこで <code>pulp init</code>を実行し ます。</p>
<pre class="text"><code>$ mkdir my-project
$ cd my-project
$ pulp init

* Generating project skeleton in ~/my-project

$ ls

bower.json  src     test</code></pre>
<p>Pulpは2つのディレクトリ <code>src</code>、 <code>test</code>と設定ファイル <code>bower.json</code>を作成してくれます。 <code>src</code>ディレクトリにはソースコードファイルを保存し、 <code>test</code>ディレクトリにはテストコードファイルを保存します。 <code>test</code>ディレクトリについては、この本の後半で使用します。</p>
<p><code>src/Main.purs</code>という名前のファイルに、以下のコードを貼り付けます。</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Control.Monad.Eff.Console</span>

main <span class="fu">=</span> log <span class="st">&quot;Hello, World!&quot;</span></code></pre></div>
<p>これは小さなサンプルコードですが、​​いくつかの重要な概念を示しています。</p>
<ul>
<li>すべてのソースファイルはモジュールヘッダから始まります。モジュール名は、ドットで区切られた大文字で始まる1つ以上の単語から構成されています。ここではモジュール名としてひとつの単語だけが使用されていますが、 <code>My.First.Module</code>というようなモジュール名も有効です。</li>
<li>モジュールは、モジュール名の各部分を区切るためのドットを含めた、完全な名前を使用してインポートされます。ここでは <code>log</code>関数を提供する <code>Control.Monad.Eff.Console</code>モジュールをインポートしています。</li>
<li>この <code>main</code>プログラムの定義本体は、関数適用の式になっています。PureScriptでは、関数適用は関数名のあとに引数を空白で区切って書くことで表します。</li>
</ul>
<p>それではこのコードをビルドして実行してみましょう。次のコマンドを実行します。</p>
<pre class="text"><code>$ pulp run

* Building project in ~/my-project
* Build successful.
Hello, World!</code></pre>
<p>おめでとうございます!　はじめてPureScriptで作成されたプログラムのコンパイルと実行ができました。</p>
<h2 id="ブラウザ向けのコンパイル"><span class="header-section-number">2.6</span> ブラウザ向けのコンパイル</h2>
<p>Pulpは <code>pulp browserify</code>を実行して、PureScriptコードをブラウザで使うことに適したJavaScriptに変換することができます。</p>
<pre class="text"><code>$ pulp browserify

* Browserifying project in ~/my-project
* Building project in ~/my-project
* Build successful.
* Browserifying...</code></pre>
<p>これに続いて、大量のJavaScriptコードがコンソールに表示されます。 これは<a href="http://browserify.org/">Browserify</a>ツールの出力で、<strong>Prelude</strong>と呼ばれる標準のPureScriptライブラリに加えて、 <code>src</code>ディレクトリのコードにも適用されます。 このJavaScriptコードをファイルに保存し、HTML文書に含めることもできます。 これを試しに実行してみると、ブラウザのコンソールに&quot;Hello、World！&quot;という文章が出力されます。</p>
<h2 id="使用されていないコードを取り除く"><span class="header-section-number">2.7</span> 使用されていないコードを取り除く</h2>
<p>Pulpは代替コマンド <code>pulp build</code>を提供しています。 <code>-O</code>オプションで<strong>未使用コードの削除</strong>を適用すると、不要なJavaScriptを出力から取り除くことができます。</p>
<pre class="text"><code>$ pulp build -O --to output.js

* Building project in ~/my-project
* Build successful.
* Bundling Javascript...
* Bundled.</code></pre>
<p>この場合も、生成されたコードはHTML文書で使用できます。 <code>output.js</code>を開くと、次のようなコンパイルされたモジュールがいくつか表示されます。</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">(<span class="kw">function</span>(exports) <span class="op">{</span>
  <span class="st">&quot;use strict&quot;</span><span class="op">;</span>

  <span class="kw">var</span> Control_Monad_Eff_Console <span class="op">=</span> PS[<span class="st">&quot;Control.Monad.Eff.Console&quot;</span>]<span class="op">;</span>

  <span class="kw">var</span> main <span class="op">=</span> <span class="va">Control_Monad_Eff_Console</span>.<span class="at">log</span>(<span class="st">&quot;Hello, World!&quot;</span>)<span class="op">;</span>
  exports[<span class="st">&quot;main&quot;</span>] <span class="op">=</span> main<span class="op">;</span>
<span class="op">}</span>)(PS[<span class="st">&quot;Main&quot;</span>] <span class="op">=</span> PS[<span class="st">&quot;Main&quot;</span>] <span class="op">||</span> <span class="op">{}</span>)<span class="op">;</span></code></pre></div>
<p>ここでPureScriptコンパイラがJavaScriptコードを生成する方法の要点が示されています。</p>
<ul>
<li>すべてのモジュールはオブジェクトに変換され、そのオブジェクトにはそのモジュールのエクスポートされたメンバが含まれています。モジュールは即時関数パターンによってスコープが限定されたコードで初期化されています。</li>
<li>PureScriptは可能な限り変数の名前をそのまま使おうとします。</li>
<li>PureScriptにおける関数適用は、そのままJavaScriptの関数適用に変換されます。</li>
<li>引数のない単純な呼び出しとしてメインメソッド呼び出しが生成され、すべてのモジュールが定義された後に実行されます。</li>
<li>PureScriptコードはどんな実行時ライブラリにも依存しません。コンパイラによって生成されるすべてのコードは、あなたのコードが依存するいずれかのPureScriptモジュールをもとに出力されているものです。</li>
</ul>
<p>PureScriptはシンプルで理解しやすいコードを生成すること重視しているので、これらの点は大切です。実際に、ほとんどのコード生成処理はごく軽い変換です。PureScriptについての理解が比較的浅くても、ある入力からどのようなJavaScriptコードが生成されるかを予測することは難しくありません。</p>
<h2 id="commonjsモジュールのコンパイル"><span class="header-section-number">2.8</span> CommonJSモジュールのコンパイル</h2>
<p>pulpは、PureScriptコードからCommonJSモジュールを生成するためにも使用できます。 これは、NodeJSを使用する場合やCommonJSモジュールを使用してコードを小さなコンポーネントに分割する大きなプロジェクトを開発する場合に便利です。</p>
<p>CommonJSモジュールをビルドするには、（ <code>-O</code>オプションなしで） <code>pulp build</code>コマンドを使います。</p>
<pre class="text"><code>$ pulp build

* Building project in ~/my-project
* Build successful.</code></pre>
<p>生成されたモジュールはデフォルトで <code>output</code>ディレクトリに置かれます。 各PureScriptモジュールは、それ自身のサブディレクトリにある独自のCommonJSモジュールにコンパイルされます。</p>
<h2 id="bowerによる依存関係の追跡"><span class="header-section-number">2.9</span> Bowerによる依存関係の追跡</h2>
<p>この章の目的となっている <code>diagonal</code>関数を書くためには、平方根を計算できるようにする必要があります。 <code>purescript-math</code>パッケージにはJavaScriptの <code>Math</code>オブジェクトのプロパティとして定義されている関数の型定義が含まれていますので、 <code>purescript-math</code>パッケージをインストールしてみましょう。 <code>npm</code>の依存関係でやったのと同じように、次のようにコマンドラインに入力すると直接このパッケージをダウンロードできます。</p>
<pre class="text"><code>$ bower install purescript-math --save</code></pre>
<p><code>--save</code>オプションは依存関係を <code>bower.json</code>設定ファイルに追加させます。</p>
<p><code>purescript-math</code>ライブラリは、依存するライブラリと一緒に <code>bower_components</code>サブディレクトリにインストールされます。</p>
<h2 id="対角線の長さの計算"><span class="header-section-number">2.10</span> 対角線の長さの計算</h2>
<p>それでは外部ライブラリの関数を使用する例として <code>diagonal</code>関数を書いてみましょう。</p>
<p>まず、 <code>src/Main.purs</code>ファイルの先頭に次の行を追加し、 <code>Math</code>モジュールをインポートします。</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Math</span> (sqrt)</code></pre></div>
<p>また、数値の加算や乗算のようなごく基本的な演算を定義する <code>Prelude</code>モジュールをインポートすることも必要です。</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Prelude</span></code></pre></div>
<p>そして、次のように <code>diagonal</code>関数を定義します。</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">diagonal w h <span class="fu">=</span> sqrt (w <span class="fu">*</span> w <span class="fu">+</span> h <span class="fu">*</span> h)</code></pre></div>
<p>この関数の型を定義する必要はないことに注意してください。 <code>diagonal</code>は2つの数を取り数を返す関数である、とコンパイラは推論することができます。しかし、ドキュメントとしても役立つので、通常は型注釈を提供しておくことをお勧めします。</p>
<p>それでは、新しい <code>diagonal</code>関数を使うように <code>main</code>関数も変更してみましょう。</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">main <span class="fu">=</span> logShow (diagonal <span class="fl">3.0</span> <span class="fl">4.0</span>)</code></pre></div>
<p><code>pulp run</code>を使用して、モジュールを再コンパイルします。</p>
<pre class="text"><code>$ pulp run

* Building project in ~/my-project
* Build successful.
5.0</code></pre>
<h2 id="対話式処理系を使用したコードのテスト"><span class="header-section-number">2.11</span> 対話式処理系を使用したコードのテスト</h2>
<p>PureScriptコンパイラには <code>PSCi</code>と呼ばれる対話式のREPL(Read-eval-print loop)が付属しています。 <code>PSCi</code>はコードをテストなど思いついたことを試すのにとても便利です。それでは、 <code>psci</code>を使って <code>diagonal</code>関数をテストしてみましょう。</p>
<p><code>pulp repl</code>コマンドを使ってソースモジュールを自動的に <code>PSCi</code>にロードすることができます。</p>
<pre class="text"><code>$ pulp repl
&gt;</code></pre>
<p>コマンドの一覧を見るには、 <code>:?</code>と入力します。</p>
<pre class="text"><code>&gt; :?
The following commands are available:

    :?                        Show this help menu
    :quit                     Quit PSCi
    :reset                    Reset
    :browse      &lt;module&gt;     Browse &lt;module&gt;
    :type        &lt;expr&gt;       Show the type of &lt;expr&gt;
    :kind        &lt;type&gt;       Show the kind of &lt;type&gt;
    :show        import       Show imported modules
    :show        loaded       Show loaded modules
    :paste       paste        Enter multiple lines, terminated by ^D</code></pre>
<p>Tabキーを押すと、自分のコードで利用可能なすべての関数、及びBowerの依存関係とプレリュードモジュールのリストをすべて見ることができるはずです。</p>
<p><code>Prelude</code>モジュールを読み込んでください。</p>
<pre class="text"><code>&gt; import Prelude</code></pre>
<p>幾つか数式を評価してみてください。 <code>PSCi</code>で評価を行うには、1行以上の式を入力し、Ctrl+ Dで入力を終了します。</p>
<pre class="text"><code>&gt; 1 + 2
3

&gt; &quot;Hello, &quot; &lt;&gt; &quot;World!&quot;
&quot;Hello, World!&quot;</code></pre>
<p>それでは <code>PSCi</code>で <code>diagonal</code>関数を試してみましょう。</p>
<pre class="text"><code>&gt; import Main
&gt; diagonal 5.0 12.0

13.0</code></pre>
<p>また、 <code>PSCi</code>で関数を定義することもできます。</p>
<pre class="text"><code>&gt; double x = x * 2

&gt; double 10
20</code></pre>
<p>コード例の構文がまだよくわからなくても心配はいりません。 この本を読み進めるうちにわかるようになっていきます。</p>
<p>最後に、 <code>:type</code>コマンドを使うと式の型を確認することができます。</p>
<pre class="text"><code>&gt; :type true
Boolean

&gt; :type [1, 2, 3]
Array Int</code></pre>
<p><code>PSCi</code>で試してみてください。もしどこかでつまずいた場合は、メモリ内にあるコンパイル済みのすべてのモジュールをアンロードするリセットコマンド <code>：reset</code>を使用してみてください。</p>
<blockquote>
<h2 id="演習" class="unnumbered">演習</h2>
<ol type="1">
<li><p>(簡単） <code>Math</code>モジュールで定義されている <code>pi</code>定数を使用し、指定された半径の円の面積を計算する関数 <code>circleArea</code>を書いてみましょう。また、 <code>PSCi</code>を使用してその関数をテストしてください。 (<strong>ヒント</strong>： <code>import math</code>文を修正して、 <code>pi</code>をインポートすることを忘れないようにしましょう)</p></li>
<li><p>（やや難しい） <code>purecript-globals</code>パッケージを依存関係としてインストールするには、<code>bower install</code>を使います。PSCiでその機能を試してみてください。 (<strong>ヒント</strong>： PSCiの <code>：browse</code>コマンドを使うと、モジュールの内容を閲覧することができます)</p></li>
</ol>
</blockquote>
<h2 id="まとめ"><span class="header-section-number">2.12</span> まとめ</h2>
<p>この章では、Pulpツールを使用して簡単なPureScriptプロジェクトを設定しました。</p>
<p>また、最初のPureScript関数を書き、コンパイルし、NodeJSを使用して実行することができました。</p>
<p>以降の章では、コードをコンパイルやデバッグ、テストするためにこの開発設定を使用しますので、これらのツールや使用手順に十分習熟しておくとよいでしょう。</p>
<a href="chapter03.html">
<div class="next">
次の第3章を読む
</div>
</a>
<p class="home">
<a href="index.html">&lt; 目次に戻る</a>
</p>
    </div>
  </div>
</body>
</html>
