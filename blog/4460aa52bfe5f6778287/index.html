<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@cubbit2"><meta name="twitter:creator" content="@cubbit2"><meta name="twitter:title" content="逆引きLensサンプルコード - ちょっと小さいのはたしかですが。"><meta name="twitter:description"><meta name="twitter:image"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="icon.png"><link rel="stylesheet" href="/res/reset.css"><link rel="stylesheet" href="/res/style.css"><title>逆引きLensサンプルコード - ちょっと小さいのはたしかですが。</title><script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-61162129-3', 'auto');
                ga('send', 'pageview');
            </script></head><body><header><div class="sns"><a target="_blank" href="https://twitter.com/intent/tweet?text=undefined%20https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287"><img src="/res/twitter.png" alt="twitter button"></a><a target="brank" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287&amp;t=undefined"><img src="/res/facebook.png" alt="facebook button"></a><a target="brank" href="https://plus.google.com/share?url=https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287"><img src="/res/google.png" alt="google plus button"></a><a target="brank" href="http://b.hatena.ne.jp/entry/https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287"><img src="/res/hatena.png" alt="hatena bookmark button"></a><a target="brank" href="http://getpocket.com/edit?url=https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287&amp;title=undefined"><img src="/res/pocket.png" alt="pocket button"></a></div><div class="block-centered"><div class="site-title"><a href="/">Admittedly <wbr>something <wbr>small.</a></div><div class="sub-title">ちょっと<wbr>小さいのは<wbr>たしかですが。</div></div></header><div class="content"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/res/article.css"><article id="rendered"><div class="date">2016年2月7日</div><h1 class="article-title"><a href=".">逆引きLensサンプルコード</a></h1><p class="tags"><a href="/blog/tag/Haskell"><span class="tag"><i class="fa fa-tag"></i>Haskell</span></a><a href="/blog/tag/purescript"><span class="tag"><i class="fa fa-tag"></i>purescript</span></a></p><hr><div><p>複雑なデータ構造の内部への読み書きを抽象化するライブラリ<a href="https://github.com/ekmett/lens">Lens</a>の練習メモです。言語はPureScriptを使っています。この記事はHaskellな人も読めなくはないと思いますが、PureScriptとHaskellでは異なる部分が結構あるので注意してください。パッケージは<a href="https://github.com/purescript-contrib/purescript-profunctor-lenses"><code>purescript-profunctor-lenses</code></a>を使っています<a class="link-footnote" href="#footnote-lib" name="link-lib">※</a>。</p><h1><a id="-" class="anchor" href="#-"><span class="header-link"></span></a>単純なオブジェクトのプロパティの読み書き</h1><pre><code class="hs">--%20%u8AAD%u307F%u66F8%u304D%u3057%u305F%u3044%u30C7%u30FC%u30BF%u306E%u578B%0Atype%20Task%20%3D%20%7B%20name%20%3A%3A%20String%2C%20completed%20%3A%3A%20Boolean%20%7D</code></pre><pre><code class="hs">--%20%u30B5%u30F3%u30D7%u30EB%u30C7%u30FC%u30BF%0Atask%20%3A%3A%20Task%0Atask%20%3D%20%7B%20name%3A%20%22meeting%22%2C%20completed%3A%20false%20%7D</code></pre><pre><code class="hs">--%20Lens%u306E%u5B9A%u7FA9%0Aname%20%3A%3A%20forall%20a%20b%20.%20Lens%20%7B%20name%20%3A%3A%20a%20%7C%20b%20%7D%20%7B%20name%20%3A%3A%20a%20%7C%20b%20%7D%20a%20a%20%0Aname%20%3D%20lens%20_.name%20_%20%7B%20name%20%3D%20_%20%7D%0A%0Acompleted%20%3A%3A%20forall%20a%20b%20.%20Lens%20%7B%20completed%20%3A%3A%20a%20%7C%20b%20%7D%20%7B%20completed%20%3A%3A%20a%20%7C%20b%20%7D%20a%20a%20%0Acompleted%20%3D%20lens%20_.completed%20_%20%7B%20completed%20%3D%20_%20%7D</code></pre><pre><code class="hs">--%20lens%u3092%u4F7F%u308F%u306A%u3044%u901A%u5E38%u306E%u30D7%u30ED%u30D1%u30C6%u30A3%u8AAD%u307F%u53D6%u308A%0A--%20%u3053%u3053%u306E%u300Ename%u300F%u306FLens%u306E%60name%60%u3058%u3083%u306A%u304F%u3066%u3001JavaScript%u3068%u540C%u69D8%u306E%u305D%u3046%u3044%u3046%u5C02%u7528%u306E%u69CB%u6587%u3067%u3059%0Atask.name%20%20%20%20%20%20%20%20%20%20--%20%22meeting%22%0A%0A--%20view%u95A2%u6570%u3068%u5148%u307B%u3069%u5B9A%u7FA9%u3057%u305FLens%u306Ename%u3092%u4F7F%u3063%u305F%u30D7%u30ED%u30D1%u30C6%u30A3%u8AAD%u307F%u53D6%u308A%0Aview%20name%20task%20%20%20%20%20--%20%22meeting%22%0A%0A--%20%5E.%u6F14%u7B97%u5B50%28view%u306E%u5225%u540D%29%u306B%u3088%u308B%u306E%u30D7%u30ED%u30D1%u30C6%u30A3%u8AAD%u307F%u53D6%u308A%0A--%20view%u3068%u306F%u5F15%u6570%u306E%u9806%u5E8F%u304C%u9006%u8EE2%u3057%u3066%u3044%u308B%u306E%u306B%u6CE8%u610F%0Atask%20%5E.%20name%20%20%20%20%20%20%20%20%20--%20%22meeting%22%0A%0A--%20%u901A%u5E38%u306E%u30D7%u30ED%u30D1%u30C6%u30A3%u66F8%u304D%u8FBC%u307F%u69CB%u6587%u3002%0A--%20%u3053%u3053%u306Ecompleted%u3082Lens%u3058%u3083%u306A%u304F%u3066%u305D%u3046%u3044%u3046%u69CB%u6587%u3067%u3059%0A--%20JavaScript%u3067%u3044%u3046%20task.completed%20%3D%20true%3B%20%u3068%u3044%u3046%u30B3%u30FC%u30C9%u306E%u610F%u56F3%u306B%u8FD1%u3044%u64CD%u4F5C%u3067%u3059%u3002%0Atask%20%7B%20completed%20%3D%20true%20%7D%20%20%20%20--%20%7B%20name%3A%20%22meeting%22%2C%20completed%3A%20true%20%7D%0A%0A--%20set%u95A2%u6570%u3068Lens%u306Ecomplete%u3092%u4F7F%u3063%u305F%u66F8%u304D%u8FBC%u307F%0Aset%20completed%20true%20task%20%20%20%20%20%20--%20%7B%20name%3A%20%22meeting%22%2C%20completed%3A%20true%20%7D%0A%0A--%20.%7E%u6F14%u7B97%u5B50%0A%28completed%20.%7E%20true%29%20task%20%20%20%20%20--%20%7B%20name%3A%20%22meeting%22%2C%20completed%3A%20true%20%7D%0A%0A--%20%23%u6F14%u7B97%u5B50%u3082%u4F7F%u3046%u3068%u8A9E%u9806%u304C%u81EA%u7136%u306B%0Atask%20%23%20completed%20.%7E%20true%20%20%20%20%20--%20%7B%20name%3A%20%22meeting%22%2C%20completed%3A%20true%20%7D</code></pre><h1><a id="-" class="anchor" href="#-"><span class="header-link"></span></a>配列の読み書き</h1><pre><code class="haskell">--%20%u30B5%u30F3%u30D7%u30EB%u30C7%u30FC%u30BF%0Axs%20%3A%3A%20Array%20String%0Axs%20%3D%20%5B%22zero%22%2C%20%22one%22%2C%20%22two%22%5D%0A%0Ays%20%3A%3A%20Array%20Int%0Ays%20%3D%20%5B10%2C%2020%2C%2030%5D</code></pre><pre><code class="hs">--%20%u901A%u5E38%u306E%21%21%u6F14%u7B97%u5B50%u3067%u306E%u30A2%u30AF%u30BB%u30B9%0Axs%20%21%21%201%20%20%20%20%20%20%20%20--%20Just%20%22one%22%0A%0A--%20ix%u95A2%u6570%u3067%u6307%u5B9A%u3057%u305F%u30A4%u30F3%u30C7%u30C3%u30AF%u30B9%u3078%u306E%u30A2%u30AF%u30BB%u30B5%u3092%u4F5C%u308C%u307E%u3059%0A--%20%u57FA%u672C%u7684%u306B%u306F%5E.%u6F14%u7B97%u5B50%u3067%u306F%u306A%u304F%5E%3F%u6F14%u7B97%u5B50%u306E%u307B%u3046%u3092%u4F7F%u3044%u307E%u3059%0Axs%20%5E%3F%20ix%201%20%20%20%20%20--%20Just%20%22one%22%0A%0A--%20%u7BC4%u56F2%u5916%u3078%u306E%u30A2%u30AF%u30BB%u30B9%u306FNothing%u304C%u8FD4%u308A%u307E%u3059%0Axs%20%5E%3F%20ix%20100%20%20%20--%20Nothing%0A%0A--%20view%u95A2%u6570%u3084%5E.%u6F14%u7B97%u5B50%u3067%u3082%u30A2%u30AF%u30BB%u30B9%u3067%u304D%u307E%u3059%u304C%u3001%u305D%u306E%u5834%u5408%u306FMaybe%u3058%u3083%u306A%u3044%u30CA%u30DE%u306E%u5024%u304C%u76F4%u63A5%u8FD4%u308A%u307E%u3059%0Axs%20%5E.%20ix%201%20%20%20%20%20%20--%20%22one%22%20%0A%0A--%20%5E.%u6F14%u7B97%u5B50%u3067%u7BC4%u56F2%u5916%u306B%u30A2%u30AF%u30BB%u30B9%u3059%u308B%u3068mempty%u304C%u8FD4%u308A%u307E%u3059%20%0Axs%20%5E.%20ix%20100%20%20%20%20%20%20--%20%22%22%20%0A%0A--%20%5E.%u6F14%u7B97%u5B50%u306F%u8981%u7D20%u304CMonoid%u306E%u914D%u5217%u3067%u306A%u3044%u3068%u4F7F%u3048%u307E%u305B%u3093%0Ays%20%5E.%20ix%20100%20%20%20%20%20%20--%20%u30B3%u30F3%u30D1%u30A4%u30EB%u30A8%u30E9%u30FC%0A%0A--%20%u901A%u5E38%u306EupdateAt%u306B%u3088%u308B%u66F8%u304D%u8FBC%u307F%0A--%20updateAt%u306FMaybe%u3067%u7D50%u679C%u3092%u8FD4%u3057%u3066%u304F%u308B%u306E%u3067%u3001%u3053%u3053%u3067%u306FfromMaybe%u3067%u5931%u6557%u3092%u63E1%u308A%u3064%u3076%u3057%u3066%u3044%u307E%u3059%0AfromMaybe%20xs%20%24%20updateAt%201%20%22foo%22%20xs%20%20%20%20%20%20--%20%5B%22zero%22%2C%20%22foo%22%2C%20%22two%22%5D%0A%0A--%20ix%u3067%u306E%u6307%u5B9A%u30A4%u30F3%u30C7%u30C3%u30AF%u30B9%u3078%u306E%u66F8%u304D%u8FBC%u307F%0Axs%20%23%20ix%201%20.%7E%20%22foo%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20%5B%22zero%22%2C%20%22foo%22%2C%20%22two%22%5D%20%20%20%20%20%20%0A%0A--%20%u7BC4%u56F2%u5916%u306A%u3089%u4F55%u3082%u306A%u304B%u3063%u305F%u3053%u3068%u306B%u306A%u308B%0Axs%20%23%20ix%20100%20.%7E%20%22foo%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20%5B%22zero%22%2C%20%22one%22%2C%20%22two%22%5D</code></pre><h1><a id="strmap-" class="anchor" href="#strmap-"><span class="header-link"></span></a>StrMapの読み書き</h1><pre><code class="hs">--%20%u30B5%u30F3%u30D7%u30EB%u30C7%u30FC%u30BF%0A--%20fromFoldable%u3067%u30BF%u30D7%u30EB%u306E%u914D%u5217%u304B%u3089%u6587%u5B57%u5217%u306E%u30DE%u30C3%u30D7%u3092%u4F5C%u308C%u307E%u3059%u3002%0A--%20%u5185%u90E8%u7684%u306B%u306F%20%7B%20one%3A%201%2C%20two%3A%202%2C%20three%3A%203%20%7D%20%u3068%u3044%u3046%u3088%u3046%u306AJavaScript%u306E%u30AA%u30D6%u30B8%u30A7%u30AF%u30C8%u3068%u540C%u3058%u3082%u306E%u3067%u3059%0Anmap%20%3A%3A%20StrMap%20Int%0Anmap%20%3D%20fromFoldable%20%5B%0A%20%20%20%20Tuple%20%22one%22%201%2C%20%0A%20%20%20%20Tuple%20%22two%22%202%2C%0A%20%20%20%20Tuple%20%22three%22%203%0A%5D</code></pre><pre><code class="hs">--%20%u901A%u5E38%u306Elookup%u306B%u3088%u308B%u8AAD%u307F%u53D6%u308A%0Alookup%20%22one%22%20nmap%20%20%20%20%20%20--%20Just%201%0A%0A--%20StrMap%u306E%u5834%u5408%u3067%u3082%u3001ix%u3067%u30A4%u30F3%u30C7%u30C3%u30AF%u30B9%u306B%u6587%u5B57%u5217%u3092%u4F7F%u3046%u3060%u3051%0Anmap%20%5E%3F%20ix%20%22one%22%20%20%20%20%20%20%20--%20Just%201%0A%0A--%20%u901A%u5E38%u306Einsert%u306B%u3088%u308B%u66F8%u304D%u8FBC%u307F%0Ainsert%20%22two%22%20222%20nmap%20%20%20--%20%7B%20one%3A1%2C%20two%3A222%2C%20three%3A3%20%7D%0A%0A--%20ix%u3092%u4F7F%u3063%u305F%u66F8%u304D%u8FBC%u307F%0A--%20JavaScript%u306E%20nmap%5B%22two%22%5D%20%3D%20222%3B%20%u3068%u3044%u3046%u5F0F%u3068%u5B57%u9762%u304C%u3088%u304F%u5BFE%u5FDC%u3057%u3066%u3044%u3066%u76F4%u611F%u7684%u3067%u3059%0Anmap%20%23%20ix%20%22two%22%20.%7E%20222%20%20--%20%7B%20one%3A1%2C%20two%3A222%2C%20three%3A3%20%7D%0A%0A--%20ix%u306E%u307B%u304B%u306Bat%u3068%u3044%u3046%u3082%u306E%u3082%u3042%u308A%u307E%u3059%u3002%0A--%20ix%u306F%u30AD%u30FC%u304C%u5B58%u5728%u3057%u306A%u304B%u3063%u305F%u3068%u304D%u306B%u306F%u4F55%u3082%u8D77%u304D%u307E%u305B%u3093%u304C%u3001at%u306F%u305D%u306E%u5024%u3092%u633F%u5165%u3059%u308B%u3068%u3044%u3046%u9055%u3044%u304C%u3042%u308A%u307E%u3059%u3002%0A--%20%u305D%u306E%u305F%u3081at%u304C%u4F7F%u3048%u308B%u30B3%u30F3%u30C6%u30CA%u306B%u3082%u9055%u3044%u304C%u3042%u308A%u3001%u914D%u5217%u3084%u30EA%u30B9%u30C8%u3067%u306Fat%u306F%u4F7F%u3048%u307E%u305B%u3093%0A--%20.%7E%u306E%u4EE3%u308F%u308A%u306B%3F%7E%u3092%u4F7F%u3046%u3053%u3068%u306B%u3082%u6CE8%u610F%0Anmap%20%23%20at%20%22ten%22%20%3F%7E%2010%20%20%20%20%20%20--%20%7B%20one%3A1%2C%20two%3A2%2C%20three%3A3%2C%20ten%3A%2010%20%7D</code></pre><h1><a id="-" class="anchor" href="#-"><span class="header-link"></span></a>配列の配列の読み書き</h1><pre><code class="hs">--%20%u30B5%u30F3%u30D7%u30EB%u30C7%u30FC%u30BF%0Azs%20%3A%3A%20Array%20%28Array%20String%29%0Azs%20%3D%20%5B%5B%22zero%22%5D%2C%20%5B%22one%22%5D%2C%20%5B%22two%22%5D%5D</code></pre><pre><code class="hs">--%20%u30D9%u30BF%u306A%u65B9%u6CD5%u3067%u306E%u8AAD%u307F%u53D6%u308A%20%0A--%20%u4E00%u56DE%u76EE%u306E%u914D%u5217%u30A2%u30AF%u30BB%u30B9%u306F%u5358%u306B%21%21%u6F14%u7B97%u5B50%u306E%u9069%u7528%u306A%u306E%u306B%u3001%0A--%202%u56DE%u76EE%u306E%u30A2%u30AF%u30BB%u30B9%u306F%3C%23%3E%u3092%u565B%u307E%u305B%u308B%u3053%u3068%u306B%u306A%u308B%u4E00%u8CAB%u6027%u306E%u306A%u3055%u304C%u3061%u3087%u3063%u3068%u76F4%u611F%u7684%u3067%u306A%u3044%u3068%u601D%u3044%u307E%u3059%0Azs%20%21%21%201%20%3C%23%3E%20%28%21%21%200%29%20%20%20%20%20%20%20%20--%20Just%20%22one%22%0A%0A--%20%u4EBA%u306B%u3088%u3063%u3066%u306FFunctor%u3088%u308Ado%u8A18%u6CD5%u306E%u307B%u3046%u304C%u597D%u304D%u304B%u3082%u3057%u308C%u307E%u305B%u3093%0Ado%20xs%20%3C-%20zs%20%21%21%201%0A%20%20%20xs%20%21%21%200%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20Just%20%22one%22%0A%0A--%20%3E%3D%3E%u6F14%u7B97%u5B50%u3067%u3064%u306A%u3052%u308B%u3068%u3001%3C%23%3E%u3088%u308A%u306F%u3044%u304F%u3089%u304B%u5BFE%u79F0%u6027%u304C%u3042%u308A%u307E%u3059%0Azs%20%23%20%28%28%21%21%201%29%20%3E%3D%3E%20%28%21%21%200%29%29%20%20--%20Just%20%22one%22%0A%0A--%20lens%u306F%3C%3C%3C%u3067%u5408%u6210%u3067%u304D%u307E%u3059%u3002%u914D%u5217%u306E%u914D%u5217%u306E%u5185%u90E8%u3092%u8AAD%u3080%u306B%u306Fix%u306E2%u500B%u306ELens%u3092%u5408%u6210%u3059%u308C%u3070%u3044%u3044%20%0A--%20%u305F%u3060%u3057%u3046%u307E%u304F%u578B%u63A8%u8AD6%u304C%u3067%u304D%u305A%u3001%u578B%u6CE8%u91C8%u3092%u52A0%u3048%u306A%u3044%u3068%u30B3%u30F3%u30D1%u30A4%u30EB%u3067%u304D%u307E%u305B%u3093%0A--%20PureScript%u306E%u30B3%u30F3%u30D1%u30A4%u30E9%u306E%u554F%u984C%u306A%u306E%u304B%u3069%u3046%u304B%u307E%u3060%u3088%u304F%u308F%u304B%u308A%u307E%u305B%u3093%0Azs%20%5E%3F%20%28ix%201%20%3C%3C%3C%20ix%200%29%20%20%20%20%20--%20Just%20%22one%22%0A%0A--%20%u66F8%u304D%u8FBC%u307F%u306E%u307B%u3046%u306F%u3042%u3093%u307E%u308A%u3044%u3044%u65B9%u6CD5%u304C%u601D%u3044%u3064%u304D%u307E%u305B%u3093%0A--%20%u30DB%u30F3%u30C8%u6C5A%u3044%0Ado%20xs%20%3C-%20zs%20%21%21%201%0A%20%20%20ys%20%3C-%20updateAt%200%20%22foo%22%20xs%0A%20%20%20updateAt%201%20ys%20zs%u3000%u3000%u3000%u3000%u3000%20%20%20%20%20%20--%20%5B%5B%22zero%22%5D%2C%20%5B%22foo%22%5D%2C%20%5B%22two%22%5D%5D%0A%0A--%20lens%u3060%u3068%u5272%u308A%u3068%u7D20%u76F4%u306B%u66F8%u3051%u307E%u3059%0A--%20JavaScript%u3067%20zs%5B1%5D%5B0%5D%20%3D%20%22foo%22%3B%20%u3068%u3059%u308B%u306E%u3068%u540C%u3058%u601D%u8003%u3067%u66F8%u3051%u307E%u3059%0Azs%20%23%20%28ix%201%20%3C%3C%3C%20ix%200%29%20.%7E%20%22foo%22%20%20%20%20%20--%20%5B%5B%22zero%22%5D%2C%20%5B%22foo%22%5D%2C%20%5B%22two%22%5D%5D</code></pre><h1><a id="-" class="anchor" href="#-"><span class="header-link"></span></a>配列を含むより複雑なオブジェクトの読み書き</h1><pre><code class="hs">--%20%u578B%0Atype%20Task%20%3D%20%7B%20name%20%3A%3A%20String%2C%20completed%20%3A%3A%20Boolean%20%7D%0A%0Atype%20TodoList%20%3D%20%7B%20title%20%3A%3A%20String%2C%20tasks%20%3A%3A%20Array%20Task%20%7D</code></pre><pre><code class="hs">--%20%u30B5%u30F3%u30D7%u30EB%u30C7%u30FC%u30BF%0AtodoList%20%3A%3A%20TodoList%0AtodoList%20%3D%20%7B%0A%20%20%20%20title%3A%20%22Today%27s%20todo%22%2C%0A%20%20%20%20tasks%3A%20%5B%0A%20%20%20%20%20%20%20%20%7B%20name%3A%20%22meeting%20at%2015%3A00%22%2C%20completed%3A%20false%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20name%3A%20%22purchase%20a%20milk%22%2C%20completed%3A%20true%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20name%3A%20%22dog%20walk%22%2C%20completed%3A%20false%20%7D%0A%20%20%20%20%5D%0A%7D</code></pre><pre><code class="hs">--%20%u901A%u5E38%u306E%u30D7%u30ED%u30D1%u30C6%u30A3%u30A2%u30AF%u30BB%u30B9%u3002%0A--%20%u57FA%u672C%u7684%u306B%u306Fa.b.c.d%u3068%u30C9%u30C3%u30C8%u3067%u7E4B%u3052%u3070%u3044%u3044%u3067%u3059%u304C%u3001Maybe%u304C%u7D61%u3080%u3068%3C%23%3E%u304C%u5FC5%u8981%u306B%u306A%u3063%u3066%u8AAD%u307F%u306B%u304F%u304F%u306A%u308A%u307E%u3059%0AtodoList.tasks%20%21%21%201%20%3C%23%3E%20_.name%20%20%20%20%20%20%20%20%20%20%20--%20Just%20%22purchase%20a%20milk%22%20%20%20%20%20%20%20%20%20%0A%0A--%20Lens%u306A%u3089%3C%3C%3C%u6F14%u7B97%u5B50%u3067tasks%u3084name%u306E%u3088%u3046%u306A%u81EA%u5206%u3067%u5B9A%u7FA9%u3057%u305FLens%u3068ix%u3092%u81EA%u5728%u306B%u5408%u6210%u3067%u304D%u307E%u3059%0A--%20%u305F%u3060%u3057%u3053%u308C%u3082%u73FE%u72B6%u578B%u6CE8%u91C8%u3092%u52A0%u3048%u306A%u3044%u3068%u901A%u308A%u307E%u305B%u3093%0AtodoList%20%5E%3F%20%28tasks%20%3C%3C%3C%20ix%201%20%3C%3C%3C%20name%29%20%20%20%20--%20Just%20%22purchase%20a%20milk%22%20%20%20%20%20%20%0A%0A%0A--%20%u3053%u3046%u3044%u3046%u8907%u96D1%u306A%u30AA%u30D6%u30B8%u30A7%u30AF%u30C8%u306E%u5185%u90E8%u3092%u66F8%u304D%u63DB%u3048%u3088%u3046%u3068%u3059%u308B%u3068%u3001%u7D20%u6734%u306A%u65B9%u6CD5%u3067%u306F%u4E00%u6C17%u306B%u53EF%u8AAD%u6027%u304C%u60AA%u5316%u3057%u307E%u3059%0AtodoList%20%7B%20tasks%20%3D%20fromMaybe%20todoList.tasks%20%24%20modifyAt%201%20%28_%20%7B%20name%20%3D%20%22purchase%20two%20bottles%20of%20milk%22%20%7D%29%20todoList.tasks%20%20%7D%20%20%0A--%20%7B%0A--%20%20%20%20title%3A%20%22Today%27s%20todo%22%2C%0A--%20%20%20%20tasks%3A%20%5B%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22meeting%20at%2015%3A00%22%2C%20completed%3A%20false%20%7D%2C%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22purchase%20two%20bottles%20of%20milk%22%2C%20completed%3A%20true%20%7D%2C%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22dog%20walk%22%2C%20completed%3A%20false%20%7D%0A--%20%20%20%20%5D%0A--%20%7D%0A%0A--%20Lens%u306A%u3089%u77ED%u3044%u304F%u3066JS%u306E%u30B3%u30FC%u30C9%u306B%u3082%u3088%u304F%u4F3C%u3066%u3044%u308B%u8A9E%u9806%u3067%u76F4%u611F%u7684%0A--%20JavaScript%u3060%u3068%20todoList.tasks%5B1%5D.name%20%3D%20%22purchase%20two%20bottles%20of%20milk%22%3B%20%u3068%u66F8%u304F%u306E%u3068%u540C%u3058%u30A4%u30E1%u30FC%u30B8%0AtodoList%20%23%20%28tasks%20%3C%3C%3C%20ix%201%20%3C%3C%3C%20name%29%20.%7E%20%22purchase%20two%20bottles%20of%20milk%22%20%20%20%20%20%20%0A--%20%7B%0A--%20%20%20%20title%3A%20%22Today%27s%20todo%22%2C%0A--%20%20%20%20tasks%3A%20%5B%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22meeting%20at%2015%3A00%22%2C%20completed%3A%20false%20%7D%2C%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22purchase%20two%20bottles%20of%20milk%22%2C%20completed%3A%20true%20%7D%2C%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22dog%20walk%22%2C%20completed%3A%20false%20%7D%0A--%20%20%20%20%5D%0A--%20%7D%0A%0A--%20%u5024%u306E%u7F6E%u304D%u63DB%u3048%u3067%u306F%u306A%u304F%u3001%u5024%u306B%u5BFE%u3057%u3066%u4F8B%u3048%u3070%u914D%u5217%u306E%u8981%u7D20%u3092%u8FFD%u52A0%u3057%u305F%u3044%u306A%u3069%u306E%u64CD%u4F5C%u3092%u3059%u308B%u3068%u304D%u306F%u3001%0A--%20over%u3082%u3057%u304F%u306F%u5225%u540D%u306E%25%7E%u3092%u4F7F%u3044%u307E%u3059%u3002%0A--%20JavaScript%u3067%u3044%u3046%20todoList.tasks.push%28%7B%20name%3A%20%22have%20a%20lunch%20with%20her%22%2C%20completed%3A%20false%20%7D%29%20%u306E%u3088%u3046%u306A%u64CD%u4F5C%u306F%u6B21%u306E%u3088%u3046%u306B%u306A%u308A%u307E%u3059%0AtodoList%20%23%20tasks%20%25%7E%20%28++%20%5B%7B%20name%3A%20%22have%20a%20lunch%20with%20her%22%2C%20completed%3A%20false%20%7D%5D%29%0A--%20%7B%0A--%20%20%20%20title%3A%20%22Today%27s%20todo%22%2C%0A--%20%20%20%20tasks%3A%20%5B%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22meeting%20at%2015%3A00%22%2C%20completed%3A%20false%20%7D%2C%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22purchase%20two%20bottles%20of%20milk%22%2C%20completed%3A%20true%20%7D%2C%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22dog%20walk%22%2C%20completed%3A%20false%20%7D%2C%0A--%20%20%20%20%20%20%20%20%7B%20name%3A%20%22have%20a%20lunch%20with%20her%22%2C%20completed%3A%20false%20%7D%0A--%20%20%20%20%5D%0A--%20%7D</code></pre><h1><a id="-" class="anchor" href="#-"><span class="header-link"></span></a>直和型を含むデータ構造の読み書き</h1><pre><code class="hs">--%20%u30C7%u30FC%u30BF%u578B%0Atype%20Element%20%3D%20%7B%20name%20%3A%3A%20String%2C%20attributes%20%3A%3A%20StrMap%20String%2C%20children%20%3A%3A%20Array%20XML%20%7D%0A%0Adata%20XML%20%3D%20Text%20String%20%7C%20Element%20Element</code></pre><pre><code class="hs">--%20Lens%u3068Prism%0A--%20XML%u306E%u3088%u3046%u306B%u8907%u6570%u306E%u30C7%u30FC%u30BF%u30B3%u30F3%u30B9%u30C8%u30E9%u30AF%u30BF%u304C%u542B%u307E%u308C%u308B%u76F4%u548C%u578B%u7684%u306A%u30C7%u30FC%u30BF%u578B%u306F%u3001%0A--%20prism%u3067%u30A2%u30AF%u30BB%u30B5%u3092%u8868%u73FE%u3057%u3066%u3044%u304D%u307E%u3059%0Aelement%20%3A%3A%20Prism%20XML%20XML%20Element%20Element%0Aelement%20%3D%20prism%20Element%20%5Cs%20-%3E%20case%20s%20of%20%0A%20%20%20%20Text%20str%20-%3E%20Left%20%28Text%20str%29%0A%20%20%20%20Element%20e%20-%3E%20Right%20e%0A%0Atext%20%3A%3A%20Prism%20XML%20XML%20String%20String%0Atext%20%3D%20prism%20Text%20%5Cv%20-%3E%20case%20v%20of%20%0A%20%20%20%20Element%20elem%20-%3E%20Left%20%28Element%20elem%29%0A%20%20%20%20Text%20str%20-%3E%20Right%20str%0A%0Achildren%20%3A%3A%20forall%20a%20b%20.%20Lens%20%7B%20children%20%3A%3A%20a%20%7C%20b%20%7D%20%7B%20children%20%3A%3A%20a%20%7C%20b%20%7D%20a%20a%0Achildren%20%3D%20lens%20_.children%20_%20%7B%20children%20%3D%20_%20%7D</code></pre><pre><code class="hs">--%20%u30C7%u30FC%u30BF%0Axml%20%3A%3A%20XML%0Axml%20%3D%20Element%20%7B%20name%3A%20%22div%22%2C%20attributes%3A%20empty%2C%20children%3A%20%5B%0A%20%20%20%20Element%20%7B%20name%3A%20%22hr%22%2C%20attributes%3A%20empty%2C%20children%3A%20%5B%5D%20%7D%2C%0A%20%20%20%20Text%20%22Hello%22%20%0A%5D%20%7D</code></pre><pre><code class="hs">--%20%3C%3C%3C%u3067%u5408%u6210%u3057%u3066%u3044%u3051%u3070%u4E2D%u306E%u307B%u3046%u306B%u89E6%u308C%u308B%u306E%u3082%u7C21%u5358%0A--%20JavaScript%u306E%u3000xml.children%5B1%5D%20%u306F%u5B89%u5168%u3067%u306A%u3044%u3067%u3059%u304C%u3001Lens%u306E%u65B9%u306F%u578B%u5B89%u5168%u3067%u3059%0Axml%20%5E%3F%20%28element%20%3C%3C%3C%20children%20%3C%3C%3C%20ix%201%20%3C%3C%3C%20text%29%20%20%20%20%20--%20Just%20%22Hello%22%0A%0A--%20%u66F8%u304D%u8FBC%u307F%u3082%u7C21%u5358%0A--%20JavaScript%u3067%20xml.children%5B1%5D%20%3D%20%22See%20you%22%3B%20%u3068%u66F8%u304F%u306E%u3068%u540C%u3058%u601D%u8003%u3067%u66F8%u3051%u307E%u3059%0Axml%20%23%20%28element%20%3C%3C%3C%20children%20%3C%3C%3C%20ix%201%20%3C%3C%3C%20text%29%u3000.%7E%20%22See%20you%22%0A--%20Element%20%7B%20name%3A%20%22div%22%2C%20attributes%3A%20empty%2C%20children%3A%20%5B%0A--%20%20%20%20Element%20%7B%20name%3A%20%22hr%22%2C%20attributes%3A%20empty%2C%20children%3A%20%5B%5D%20%7D%2C%0A--%20%20%20%20Text%20%22See%20you%22%0A--%20%5D%20%7D</code></pre><h1><a id="-" class="anchor" href="#-"><span class="header-link"></span></a>さいごに</h1><p>自分はTemplate Haskellみたいな黒魔術は好きじゃないし、PureScriptにはJavaScriptに似たオブジェクト型があって構文が多少マシなのでLensなしでもいいかと思っていましたが、このあいだLensには単なるプロパティアクセス以外の面白い使い方があることを知って少し興味がわいたので、自分も練習してみることにしました。</p><p>Lensはあまりに抽象的すぎるので、APIドキュメントや定義そのものとにらめっこしても使い方は理解できないと思います。そういうライブラリは、とにかく具体的な使用例をたくさん覚えていくのがいいのではないでしょうか。もちろん定義が理解に役に立たないというわけではなく、Lensのさまざまな関数の使い方がわかったあとで定義を見返してみると理解が深まります。それに、使い道のない抽象化は、数学ならともかくプログラミングでは意味がありません。コードをどのように改善するのかという具体的な比較があってこそ、このライブラリは役に立つといえるわけです。</p><p>ただこのライブラリ、抽象的な型クラスが多すぎ、型の別名が多すぎ、型変数が多すぎ、抽象的すぎてドキュメント見ても関数の使い方がわからなすぎと、とにかく難易度が凄まじいライブラリです。自分が今まで触ったライブラリの中でも軽々トップ３には入るであろう難易度だと思います。うかつに手を出すと手首ごと食いちぎられます。その難易度のわりにコードの改善は局所的ですし、別にLensを使わなくてもちょっとコードが冗長で少し可読性が落ちるだけの話ですし、別にコードの型安全性などには変化はないし、アプリケーション全体の設計に影響するようなライブラリでもありません。Lensより優先して学ぶべきライブラリは他にたくさんあると思います。</p><p>PureScriptだと手作業でLensやPrismを定義する面倒さはもとより、型推論でちょっとハマる場面があったのもつらみを感じました。上で比較したとおり明らかに構文は改善されるので使ってみる価値はあると思いますが、他にお勧めしたいライブラリはいくらでもあるので、Lensに取り組むのは目ぼしいライブラリにひと通り触れてからでいいと思います。上で試した以外にも大量の関数や型が用意されているので、また理解が進み次第追記していこうかと思います。</p><h1><a id="-" class="anchor" href="#-"><span class="header-link"></span></a>参考文献</h1><ul>
<li><a href="https://github.com/ekmett/lens/wiki/Overview">https://github.com/ekmett/lens/wiki/Overview</a></li>
<li><a href="http://tokiwoousaka.github.io/takahashi/contents/20150530LensPrism.html">http://tokiwoousaka.github.io/takahashi/contents/20150530LensPrism.html</a></li>
<li><a href="http://stackoverflow.com/questions/29742634/could-someone-explain-the-diagram-about-the-lens-library">http://stackoverflow.com/questions/29742634/could-someone-explain-the-diagram-about-the-lens-library</a></li>
<li><a href="http://stackoverflow.com/questions/18414177/what-is-the-difference-between-ix-and-at-in-the-lens-library-of-haskell">http://stackoverflow.com/questions/18414177/what-is-the-difference-between-ix-and-at-in-the-lens-library-of-haskell</a></li>
<li><a href="http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html">http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html</a></li>
</ul>
<p class="footnote"><a href="#link-lib" name="footnote-lib">^</a>  `purescript-lens`というライブラリもあるのですが、こちらは古いライブラリでもう使われていないようです。</p></div></article></div><footer><div class="sns"><a target="_blank" href="https://twitter.com/intent/tweet?text=undefined%20https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287"><img src="/res/twitter.png" alt="twitter button"></a><a target="brank" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287&amp;t=undefined"><img src="/res/facebook.png" alt="facebook button"></a><a target="brank" href="https://plus.google.com/share?url=https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287"><img src="/res/google.png" alt="google plus button"></a><a target="brank" href="http://b.hatena.ne.jp/entry/https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287"><img src="/res/hatena.png" alt="hatena bookmark button"></a><a target="brank" href="http://getpocket.com/edit?url=https%3A%2F%2Faratama.github.io%2Fblog%2F4460aa52bfe5f6778287&amp;title=undefined"><img src="/res/pocket.png" alt="pocket button"></a></div><div class="block-centered footer-inner"><p class="copy">&amp;nbsp;</p><p class="author">このブログを書いてる人: 竹内稲穂</p></div><script>
                    const poem = [
                        "なんにもない毎日が、なによりの宝物。",
                        "今日という日を、何度でも繰り返したい。",
                        "世界を追いかけなくても、世界は私のまわりにある。", 
                        "速すぎる雑踏。鼻先をくすぐる春風。", 
                        "明日撮る写真を飾る場所を、アルバムに空けておこう。", 
                        "落ち葉が地面に、触れる音がした。", 
                        "明日は、明日の楽しさが待っている。", 
                        "風が泣いている。この想いを紡ぐ言葉を持たないから。", 
                        "もうここには何もない。だから、次の場所に旅立とう。", 
                        "もう此処にはこないだろう。そう言って私は過去に背を向けた。", 
                        "散りゆくからこそ、美しい。私は桜の花びらをかかとで踏みしめた。", 
                        "思い出はいつだって輝いてる。",
                        "正直ばかりじゃつまらない。たまには楽しい嘘をつこう。", 
                        "ゆっくり歩けば歩くほど、時間がゆっくり過ぎてゆく。",
                        "夜明けを、探しにいこう。", 
                        "空はこんなに青かったんだ。", 
                        "地球は青かった。それはこの空を見上げたことのある全員が知っている。", 
                        "休み時間は、長すぎるということはない。", 
                        "缶コーヒーを飲むときだけは、それ以外のすべてを忘れることにしてる。", 
                        "ちょっと小さいのは確かですが、それは確かにここにあります。", 
                        "ちょっと小さいのは確かですが、広すぎる家というのも寂しいでしょう？", 
                        "ひつじが一匹、ひつじが二匹。五十匹までは、数えたことがある。"
                    ];
                    document.querySelector(".copy").textContent = poem[Math.floor(poem.length * Math.random())];
                </script></footer></body></html>