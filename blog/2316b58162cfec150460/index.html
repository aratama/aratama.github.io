<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@cubbit2"><meta name="twitter:creator" content="@cubbit2"><meta name="twitter:title" content="純粋関数型スクリプト言語PureScriptのはじめかた。コンパイラの使いかたからサーバサイド/クライアントサイドアプリケーション開発まで - ちょっと小さいのはたしかですが。"><meta name="twitter:description" content="# はじめに

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;ja&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;&amp;quot;PureScript is more like Haskell than Haskell itself.&amp;q"><meta name="twitter:image" content="https://aratama.github.io/blog/2316b58162cfec150460/thumbnail.jpg"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="icon.png"><link rel="stylesheet" href="/res/reset.css"><link rel="stylesheet" href="/res/style.css"><title>純粋関数型スクリプト言語PureScriptのはじめかた。コンパイラの使いかたからサーバサイド/クライアントサイドアプリケーション開発まで - ちょっと小さいのはたしかですが。</title><script src="//cdnjs.cloudflare.com/ajax/libs/maquette/2.4.1/maquette.min.js"></script><script src="/res/gears.js"></script><script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
                ga('create', 'UA-61162129-3', 'auto');
                ga('send', 'pageview');
            </script></head><body><div class="background"></div><header><div class="sns"><a target="_blank" href="https://twitter.com/intent/tweet?text=%E7%B4%94%E7%B2%8B%E9%96%A2%E6%95%B0%E5%9E%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E8%A8%80%E8%AA%9EPureScript%E3%81%AE%E3%81%AF%E3%81%98%E3%82%81%E3%81%8B%E3%81%9F%E3%80%82%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%81%AE%E4%BD%BF%E3%81%84%E3%81%8B%E3%81%9F%E3%81%8B%E3%82%89%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%2F%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA%E3%81%BE%E3%81%A7%20-%20%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E5%B0%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%AF%E3%81%9F%E3%81%97%E3%81%8B%E3%81%A7%E3%81%99%E3%81%8C%E3%80%82 https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460"><img src="/res/twitter.png" alt="twitter button"></a><a target="brank" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460&amp;t=%E7%B4%94%E7%B2%8B%E9%96%A2%E6%95%B0%E5%9E%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E8%A8%80%E8%AA%9EPureScript%E3%81%AE%E3%81%AF%E3%81%98%E3%82%81%E3%81%8B%E3%81%9F%E3%80%82%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%81%AE%E4%BD%BF%E3%81%84%E3%81%8B%E3%81%9F%E3%81%8B%E3%82%89%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%2F%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA%E3%81%BE%E3%81%A7%20-%20%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E5%B0%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%AF%E3%81%9F%E3%81%97%E3%81%8B%E3%81%A7%E3%81%99%E3%81%8C%E3%80%82"><img src="/res/facebook.png" alt="facebook button"></a><a target="brank" href="https://plus.google.com/share?url=https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460"><img src="/res/google.png" alt="google plus button"></a><a target="brank" href="http://b.hatena.ne.jp/entry/https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460"><img src="/res/hatena.png" alt="hatena bookmark button"></a><a target="brank" href="http://getpocket.com/edit?url=https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460&amp;title=%E7%B4%94%E7%B2%8B%E9%96%A2%E6%95%B0%E5%9E%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E8%A8%80%E8%AA%9EPureScript%E3%81%AE%E3%81%AF%E3%81%98%E3%82%81%E3%81%8B%E3%81%9F%E3%80%82%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%81%AE%E4%BD%BF%E3%81%84%E3%81%8B%E3%81%9F%E3%81%8B%E3%82%89%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%2F%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA%E3%81%BE%E3%81%A7%20-%20%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E5%B0%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%AF%E3%81%9F%E3%81%97%E3%81%8B%E3%81%A7%E3%81%99%E3%81%8C%E3%80%82"><img src="/res/pocket.png" alt="pocket button"></a></div><div class="block-centered"><div class="site-title"><a href="/">Admittedly <wbr>something <wbr>small.</a></div><div class="sub-title">ちょっと<wbr>小さいのは<wbr>たしかですが。</div></div></header><div class="content"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/res/article.css"><article id="rendered"><div class="date">2016年9月16日</div><h1 class="article-title"><a href=".">純粋関数型スクリプト言語PureScriptのはじめかた。コンパイラの使いかたからサーバサイド/クライアントサイドアプリケーション開発まで</a></h1><p class="tags"><a href="/blog/tag/JavaScript"><span class="tag"><i class="fa fa-tag"></i>JavaScript</span></a><a href="/blog/tag/Haskell"><span class="tag"><i class="fa fa-tag"></i>Haskell</span></a><a href="/blog/tag/purescript"><span class="tag"><i class="fa fa-tag"></i>purescript</span></a><a href="/blog/tag/関数型プログラミング"><span class="tag"><i class="fa fa-tag"></i>関数型プログラミング</span></a></p><hr><div><h1>はじめに</h1>
<blockquote class="twitter-tweet" data-lang="ja"><p lang="en" dir="ltr">&quot;PureScript is more like Haskell than Haskell itself.&quot; – `<a href="https://twitter.com/thebeardedzug">@thebeardedzug</a></p>&mdash; Rahul Goma Phulore (@missingfaktor) <a href="https://twitter.com/missingfaktor/status/845400837841195009">2017年3月24日</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>スクリプト言語**<a href="http://www.purescript.org/">PureScript</a>**の開発環境構築から簡単なアプリケーションの作成までの手順を紹介します。この記事ではHalogenというユーザインターフェイスのフレームワークや、Hyperというサーバサイドフレームワークを動かすところまでを紹介しています。そのため、コマンドライン環境のような基本的な環境だけではなく、シングルページアプリケーションのような実用性の高いアプリケーションを作って試せるようになっています。ブラウザ環境で動けば、ウェブページに組み込んで自分が作ったアプリケーションを簡単に他の人に見せられますし、<a href="http://electron.atom.io/">Electron</a>を使って単独で動くウィンドウアプリケーションなんかも作ることができるなど夢が広がりますね。</p>
<h2>PureScriptとはどんな言語？</h2>
<p>PureScriptにはいろいろな側面がありますが、まずは<strong>AltJS</strong>、つまりJavaScriptを主なコンパイルターゲットとする言語であるのが大きな特徴でしょう。ブラウザ環境やNode環境での実行が主眼に置かれており、JavaScriptでは難しかった大規模な開発に耐えうる極めて高い堅牢性や可読性を備えています。また、膨大なJavaScriptのライブラリ資産を比較的簡単に活用できるほか、PureScriptのソースコードとそこから出力されるJavaScriptコードを対比させながら学べるという利点もあります。なお、C++やErlangのバックエンドの開発も行われています。</p>
<p>他にも、最高級の機能を備える<strong>関数型プログラミング言語</strong>としての側面も持ちます。PureScriptの構文やコンセプトの大半は、関数型プログラミング言語の代名詞的存在であるHaskellがもとになっています。しかしPureScriptはそのHaskellのコンセプトを更に洗練し、長い歴史の中で見えてきたHaskellの数々の問題点をことごとく修正し、まったくの新規の言語としてすべてを作り直しているようなものです。そのため、<strong>PureScriptはHaskell自身よりもHaskellらしい</strong>とすら言われることもあります。また、Haskellの最大の難点といえば『遅延評価』ですが(※諸説あります)、これを取り除くことでHaskellに習熟していない開発者でも馴染みやすい言語仕様になっています。</p>
<p>そして、PureScriptは<strong>スクリプト言語</strong>であることも忘れてはいけません。スクリプト言語といえば、JavaScriptとかRubyとかPythonとか、そういう動的型付けで様々なシンタックスシュガーが山盛りな言語というイメージですが、PureScriptは極めて厳格な静的型付け、そして機能を絞り込んだ言語仕様や抽象度の高いAPIなどを持つ、どう考えてもその対極に位置する言語です。でも、なにしろ名前に『スクリプト』って入っているので誰がなんと言おうとPureScriptはスクリプト言語です。スクリプト言語らしい、ゆるい気持ちで取り組みましょう。</p>
<h2>前提となる知識</h2>
<p>PureScriptは主にAltJSとしてJavaScript環境で開発される以上、JavaScriptの周辺ツールを頻繁に使うことになります。</p>
<ul>
<li>HTML/CSS/JavaScript</li>
<li>Node環境でのJavaScript開発。CommonJSモジュール</li>
<li>パッケージマネージャ。npm/Bower</li>
<li>Browserify(Webpack/Rollup)</li>
<li>reactに代表される仮想DOMの概要</li>
</ul>
<p>nodeやbower、browserifyといった基本的なツールは、予めインストールしておいてください。ここに挙げられているものでよく知らないものがあれば、先に簡単に調べておきましょう。</p>
<p>なお、Bowerはもはや非推奨のツールです。現在PureScriptも徐々にBowerへの依存を排除しつつあり、最終的にはBowerから完全に脱却すると思われます。ただ、psc-packageという独自のパッケージマネージャも試験的に開発されていますが、現時点ではまだBowerを使わずに実用的な開発をするのは難しいです。当面はBowerを使いましょう。</p>
<h1>Node環境での開発</h1>
<p>まずは一番シンプルに、Nodeのコマンドライン環境でPureScriptコードを動かすところまで説明します。</p>
<h2>コンパイラのインストール</h2>
<p>何をするにも、まずはコンパイラが必要です。nodeがインストールしてあれば、最新版のコンパイラをインストールするには次のコマンド一発だけです。</p>
<pre><code class="language-bash">$ npm install -g purescript
</code></pre>
<p>ここではグローバルにインストールしていますが、もちろんお好みでローカルにインストールしても構いません。コンパイル済みバイナリパッケージのインストールなら数十秒で終わると思います。</p>
<h2>ソースファイルの作成</h2>
<p>HelloWorldのソースファイルを作成しましょう。新しいプロジェクトのために適当なディレクトリを作成して、そこに<code>src/Main.purs</code>というファイルを作成し、次のようなコードをコピペして保存してください。PureScriptソースファイルの拡張子は<code>.purs</code>を使います。</p>
<pre><code class="language-haskell:src/Main.purs">module Main where

import Prelude
import Control.Monad.Eff (Eff)
import Control.Monad.Eff.Console (CONSOLE, log)

main :: Eff (console :: CONSOLE) Unit
main = log &quot;Hello, world!&quot;
</code></pre>
<h2>PureScriptパッケージのインストール</h2>
<p>PureScriptコンパイラには一切のライブラリが付属しておらず、コンパイラのみでは標準出力はおろか足し算すらできません。すべてのライブラリがコンパイラから完全に分離されているので、まずはプロジェクトにbowerで必要なPureScriptパッケージをインストールしなければなりません。標準出力を行うには<a href="https://pursuit.purescript.org/packages/purescript-console"><code>purescript-console</code>パッケージ</a>を使いますので、インストールしておきましょう。<code>bower install</code>でパッケージ名を指定するだけです。</p>
<pre><code class="language-bash">$ bower install --save purescript-console
</code></pre>
<p>このように、プロジェクトで必要になるたびにbowerでパッケージを集めてきます。開発が進むと他にもいろいろなパッケージが欲しくなると思いますが、PureScriptのパッケージを探すには、<a href="https://pursuit.purescript.org/">pursuit</a>というドキュメント検索サービスを使うか、<a href="https://bower.io/search/">bowerのサイト</a>で&quot;purescript&quot;というキーワードで検索するといいと思います。bowerに登録されていないライブラリも結構あるので、<a href="https://github.com/search?utf8=%E2%9C%93&amp;q=purescript">githubで探してみる</a>のもいいと思います。</p>
<h2>コンパイル</h2>
<p>PureScriptのツール群は<code>purs</code>という単一の実行可能ファイルにまとめられており、この<code>purs</code>に続いて任意のコマンドを入力することでそれぞれのツールを起動します。PureScriptソースコードをコンパイルするには**<code>purs compile</code>コマンド**を実行しますが、引数にはコンパイルに必要なソースファイルのパスをすべて列挙して与えます。パスにはglobが効きますので、<code>purs compile &quot;**/*.purs&quot;</code>のように指定すれば、<code>.purs</code>の拡張子を持つファイルを片っ端から見つけ出してまとめてコンパイルできます。ただしそのコマンドでは、複数のパッケージをインストールした時に、テスト用のコードのモジュール名が衝突してコンパイルに失敗するケースがあります。基本的には次のようにして、<code>src</code>ディレクトリだけを対象に含めるように指定するといいと思います。</p>
<pre><code class="language-bash">$ purs compile &quot;bower_components/purescript-*/src/**/*.purs&quot; &quot;src/**/*.purs&quot;
</code></pre>
<p>また、パスをダブルクォーテーションで囲まずに渡すと、環境によってはシェルがパスのワイルドカードを勝手に展開してしまい、それがpscのglobの挙動と微妙に異なっているためコンパイルが通らないことがありました。psc自身にglobが備わっているので、シェルにワイルドカードを展開されないようにしてください。</p>
<p>成功すれば、<code>output</code>ディレクトリ以下にコンパイルされたJavaScriptコードが出力されているはずです。例として、<code>Main.purs</code>がコンパイルされた結果の<code>output/Main/index.js</code>を掲載しておきます。</p>
<pre><code class="language-js:output/Main/index.js">// Generated by psc version 0.10.5
&quot;use strict&quot;;
var Prelude = require(&quot;../Prelude&quot;);
var Control_Monad_Eff = require(&quot;../Control.Monad.Eff&quot;);
var Control_Monad_Eff_Console = require(&quot;../Control.Monad.Eff.Console&quot;);
var main = Control_Monad_Eff_Console.log(&quot;Hello, world!&quot;);
module.exports = {
    main: main
};
</code></pre>
<h2>Node環境でHelloWorld</h2>
<p>コンパイルされて出力されたJavaScriptソースファイルはCommonJSモジュールになっているので、JavaScriptで直接書かれた通常のモジュールのように扱うことができます。例えば次のようにすればNode環境で先ほどのHelloWorldを実行することができます。</p>
<pre><code class="language-bash">$ node
&gt; const Main = require('./output/Main/index')
undefined
&gt; Main.main()
Hello, world!
{}
</code></pre>
<h1>Hyperによるサーバーサイドアプリケーションの開発</h1>
<p>次は、<a href="https://github.com/owickstrom/hyper"><strong>Hyper</strong></a>というかなり本格的なサーバサイドアプリケーション開発用のライブラリを使って、アクセスすると<code>Hello</code>とだけ返す簡単なサーバサイドウェブアプリケーションを作ってみましょう。サンプルコードを<a href="https://github.com/owickstrom/hyper/blob/master/examples/HelloHyper.purs">こちら</a>からコピペしてきました。</p>
<pre><code class="language-haskell:src/Examples/HelloHyper.purs">module Examples.HelloHyper where

import Prelude
import Control.IxMonad ((:*&gt;))
import Control.Monad.Eff (Eff)
import Control.Monad.Eff.Console (CONSOLE)
import Hyper.Node.Server (defaultOptionsWithLogging, runServer)
import Hyper.Response (closeHeaders, respond, writeStatus)
import Hyper.Status (statusOK)
import Node.HTTP (HTTP)

main :: forall e. Eff (console :: CONSOLE, http :: HTTP | e) Unit
main =
  let app = writeStatus statusOK
            :*&gt; closeHeaders
            :*&gt; respond &quot;Hello, Hyper!&quot;
  in runServer defaultOptionsWithLogging {} app
</code></pre>
<p>HyperのBowerパッケージの名前は<code>purescript-hyper</code>です。忘れないようにパッケージをインストールし、それからコンパイルして、うまく行ったら<code>node</code>でアプリケーションを起動してみましょう。起動するときはモジュールの名前を間違えないように気をつけてください。</p>
<pre><code class="language-bash">$ bower install --save purescript-hyper
$ purs compile &quot;bower_components/purescript-*/src/**/*.purs&quot; &quot;src/**/*.purs&quot;
$ node
&gt; const HelloHyper = require('./output/Examples.HelloHyper/index')
undefined
&gt; HelloHyper.main()
undefined
&gt; Listening on http://localhost:3000
</code></pre>
<p>これで、あとはブラウザで http://localhost:3000/ にアクセスすれば<code>Hello, Hyper!</code>と表示されると思います。このコンパイルで生成されたアプリケーションは、もちろんNodeが動く環境ならどんなサーバでも実行することができます。ただし、上の手順で起動するのは少々面倒なので、次のような起動用のスクリプトを用意して起動してもいいでしょう。</p>
<pre><code class="language-js:main.js">const HelloHyper = require('./output/Examples.HelloHyper/index');
HelloHyper.main();
</code></pre>
<pre><code class="language-shell-session">$ node main.js
Listening on http://localhost:3000
</code></pre>
<p>また、以降の節で紹介する<code>purs bundle</code>コマンドを使えば、すべてのモジュールを結合しつつ、単独でそのまま起動できるモジュールを作ることができます。</p>
<h1>ブラウザ環境での実行</h1>
<p>次は、ブラウザ環境でPureScriptアプリケーションを実行してみましょう。ブラウザ環境ではCommonJSモジュールは直接インポート出来ませんので、<code>purs bundle</code>というコマンドを使って、事前にモジュールを単一のJavaScriptファイルへと結合しておくのがいいと思います。コードは先程のHelloWorldを再び使いましょう。</p>
<pre><code class="language-haskell:src/Main.purs">module Main where

import Prelude
import Control.Monad.Eff (Eff)
import Control.Monad.Eff.Console (CONSOLE, log)

main :: Eff (console :: CONSOLE) Unit
main = log &quot;Hello, world!&quot;
</code></pre>
<p><code>psc</code>でコンパイルした結果はただのCommonJSモジュールなので、<code>browserify</code>や<code>webpack</code>で結合することもできるのですが、<code>psc-bundle</code>で結合したほうが劇的にサイズが小さくなるので、なるべく<code>psc-bundle</code>を使ったほうがいいです。</p>
<pre><code class="language-bash">$ purs compile &quot;bower_components/purescript-*/src/**/*.purs&quot; &quot;src/**/*.purs&quot;
$ purs bundle &quot;output/**/*.js&quot; --module Main --main Main --output public/app.js
</code></pre>
<p><code>purs bundle</code>コマンドのオプションは次のとおりです。</p>
<ul>
<li><code>--module</code>オプションでモジュールを指定すると、そのモジュールに関連したモジュールだけが結合されます。このオプションを指定しなくても動きますが、ファイルサイズが劇的に小さくなるので指定したほうがいいです。ただし、コマンドの実行に少し時間がかかると思います</li>
<li><code>--output</code>オプションで出力先ファイルを選べます。指定しない場合は結合の結果が標準出力に垂れ流されます</li>
<li><code>--main</code>オプションでモジュールを指定すると、そのモジュールの<code>main</code>が実行されるコードが追加されます。この場合、コンパイル後のコードの最後に<code>PS[&quot;Main&quot;].main();</code>という一行が追加されます。</li>
</ul>
<p>短いのでコンパイル後のコードを全文掲載しておきます。</p>
<pre><code class="language-js:public/app.js">// Generated by psc-bundle 0.11.4
var PS = {};
(function(exports) {
    &quot;use strict&quot;;

  exports.log = function (s) {
    return function () {
      console.log(s);
      return {};
    };
  };
})(PS[&quot;Control.Monad.Eff.Console&quot;] = PS[&quot;Control.Monad.Eff.Console&quot;] || {});
(function(exports) {
  // Generated by purs version 0.11.4
  &quot;use strict&quot;;
  var $foreign = PS[&quot;Control.Monad.Eff.Console&quot;];
  var Control_Monad_Eff = PS[&quot;Control.Monad.Eff&quot;];
  var Data_Show = PS[&quot;Data.Show&quot;];
  var Data_Unit = PS[&quot;Data.Unit&quot;];
  exports[&quot;log&quot;] = $foreign.log;
})(PS[&quot;Control.Monad.Eff.Console&quot;] = PS[&quot;Control.Monad.Eff.Console&quot;] || {});
(function(exports) {
    &quot;use strict&quot;;
  var Control_Monad_Eff = PS[&quot;Control.Monad.Eff&quot;];
  var Control_Monad_Eff_Console = PS[&quot;Control.Monad.Eff.Console&quot;];
  var Prelude = PS[&quot;Prelude&quot;];        
  var main = Control_Monad_Eff_Console.log(&quot;Hello, world!&quot;);
  exports[&quot;main&quot;] = main;
})(PS[&quot;Main&quot;] = PS[&quot;Main&quot;] || {});
PS[&quot;Main&quot;].main();
</code></pre>
<p>これを読み込む<code>public/index.html</code>を適当に作成しておきます。</p>
<pre><code class="language-html:public/index.html">&lt;!doctype html&gt;
&lt;script src=&quot;app.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p><code>public/index.html</code>をブラウザで開くと、コンソールに<code>Hello, world!</code>と表示されるはずです。</p>
<p><code>psc-bundle</code>で結合したコードは、もちろんNode環境でも次のようにして実行できます。</p>
<pre><code class="language-bash">$ node public/app.js
Hello, world!
</code></pre>
<p>単体のアプリケーションを作る場合は、起動したあとでいちいち<code>require</code>を呼び出してモジュールをロードするのは面倒ですから、<code>purs bundle</code>でバンドルしてしまうのがいいと思います。</p>
<h1>Halogenによるクライアントサイドウェブアプリケーション開発</h1>
<p>PureScriptのUIフレームワークでは<a href="https://github.com/slamdata/purescript-halogen"><code>purescript-halogen</code></a>というのが一番メジャーです。このフレームワークのテンプレートプロジェクト<a href="https://github.com/slamdata/purescript-halogen-template">purescript-halogen-template</a>があるので、これをgitでも何でも構わないのでダウンロードしてきましょう。<code>my-halogen-project</code>のところはお好みでどうぞ。</p>
<pre><code class="language-bash">$ git clone https://github.com/slamdata/purescript-halogen-template.git my-halogen-project
$ cd my-halogen-project
</code></pre>
<p>それから、<code>npm install</code>や<code>bower update</code>でこのテンプレートプロジェクトが依存するパッケージをかき集めます。</p>
<pre><code class="language-bash">$ npm install --production
$ bower update
</code></pre>
<p>これができたらビルド可能になるので、先ほどと同じコマンドで<code>psc</code>を叩いてコンパイルし、それから<code>psc-bundle</code>を叩いて結合します。</p>
<pre><code class="language-bash">$ purs compile &quot;bower_components/purescript-*/src/**/*.purs&quot; &quot;src/**/*.purs&quot;
$ purs bundle &quot;output/**/*.js&quot; --module Main --main Main --output dist/app.js
</code></pre>
<p><code>dist/index.html</code>を開くと、ボタンをクリックするたびに表示が切り替わるページが表示されるのがわかると思います。あとはお好みでuglifyなんかで圧縮してもいいと思います。</p>
<pre><code class="language-bash">$ purs bundle &quot;output/**/*.js&quot; --module Main --main Main | uglifyjs &gt; dist/app.js
</code></pre>
<p>これで、PureScriptで本格的なシングルページアプリケーションを開発する準備が整いました。この記事ではコンパイラを直接叩きましたが、必要に応じてシェルスクリプトやnpmスクリプトなどで自動化しておくと楽かと思います。このHalogenというフレームワークを使ってどのようにアプリケーションを開発すればいいのかは、また別に記事を書きたいと思っています。</p>
<h1>ビルドタスクの自動化</h1>
<p>先に説明したコマンドをいちいち手で打つのは面倒くさいので、筆者はnpmスクリプトに次のような感じで書いておくことが多いです。</p>
<pre><code class="language-text:package.json">  &quot;scripts&quot;: {
    &quot;prebuild&quot;: &quot;purs compile \&quot;bower_components/purescript-*/src/**/*.purs\&quot; \&quot;src/**/*.purs\&quot;&quot;,
    &quot;build&quot;: &quot;purs bundle \&quot;output/**/*.js\&quot; --module Main --main Main --output public/index.js&quot;
  },
</code></pre>
<p>これで、<code>npm run build</code>を実行すれば単体で実行可能なJavaScriptが<code>public/index.js</code>に出力されます。ビルド自体はコンパイラを直接叩いてもそれほど難しくはないと筆者は思うんですが、一連の作業をさらに簡略化するためにはPureScript専用のビルドツール**<a href="https://github.com/bodil/pulp">pulp</a>**を導入する方法があります。これを使うとブランクなプロジェクトの作成もコマンド一発、コンパイルもコマンド一発です。たまに意味の分からないエラーが出て頭を抱えることもあるんですが、楽なのは確かです。多くのPureScriptプロジェクトで使われているので、いろんなライブラリを試したりするときにいずれ使うことになると思います。</p>
<p>pulpの導入自体は<code>npm install</code>で一発です。</p>
<pre><code class="language-bash">$ npm install -g purescript pulp
</code></pre>
<p>あとは適当なディレクトリを作って、<code>pulp init</code>で空のプロジェクトが作成できます。また<code>pulp run</code>でそのプロジェクトをビルドし実行することができます。</p>
<pre><code class="language-bash">$ pulp init
$ pulp run
</code></pre>
<p>筆者があまりpulpを使っていないのもあって、ここではこれ以上詳しい解説はしません。詳しい使い方についてはgithubのプロジェクトページなどを確認してください。</p>
<h1>統合開発環境psc-ideの紹介</h1>
<p>PureScriptのコンパイラには<a href="https://github.com/purescript/purescript/tree/master/psc-ide-server">psc-ide</a>というIDE、つまり統合開発環境が付属していています。『統合開発環境』といってもVisual StudioやEclipseのようなゴッツいものではなくて、コンパイラと連携してコードの問題の修復なんかを自動的に実行するためのインターフェイスを提供するコマンドライン上で動くプログラムです。このpsc-ideを使うための拡張が各種エディタについて提供されています。</p>
<ul>
<li>Emacs: https://github.com/epost/psc-ide-emacs</li>
<li>Atom: https://github.com/nwolverson/atom-ide-purescript</li>
<li>Visual Studio Code: https://github.com/nwolverson/vscode-ide-purescript</li>
<li>Vim: https://github.com/FrigoEU/psc-ide-vim</li>
</ul>
<p>PureScriptではモジュールのインポートがとにかく面倒くさいのですが、ide-purescriptを使ったら簡単にインポートを整理できるようになってだいぶ楽になりました。推論された関数の型の型注釈を補間してくれる機能や、カーソルを合わせると関数の型を表示してくれる機能なんかは、入門したてのころは特に役に立つと思います。</p>
<h1>このあとは</h1>
<ul>
<li><strong><a href="https://leanpub.com/purescript/read">&quot;PureScript by Example&quot;</a></strong> オリジナルの作者philさんが書いたPureScriptの入門書です。無料で読めます。PureScriptを使いたいならまっさきに読みたい。PureScriptに限らず、現代的な関数型プログラミングの一般的な入門としても適しています。SICPみたいな古文書を読んでる場合じゃないぞ！</li>
<li><a href="https://github.com/purescript/purescript/wiki">Wiki</a> Wikiにも色々情報があります</li>
<li><a href="https://github.com/paf31/24-days-of-purescript-2016">24-days-of-purescript-2016</a> 小ネタ集</li>
<li><a href="https://github.com/purescript/documentation">purescript/documentation</a> ドキュメント用のリポジトリができたらしいです</li>
</ul>
<p>なお、これ全部<strong>英語</strong>です。がんばろう。</p>
<h1>気になるIssueメモ（随時更新）</h1>
<ul>
<li><a href="https://github.com/purescript/purescript/issues/2345">Inlining #2345</a> インライン化の話。PureScriptは現時点ではあまり最適化に力を入れていません。でも私もPureScriptのパフォーマンスの問題で躓いたことがあったので、もっと強力な最適化ができるといいとは思うのですが……。</li>
<li><a href="https://github.com/purescript/purescript/issues/2207">Support ES6 and beyond?</a> / <a href="https://github.com/purescript/purescript/issues/2574">Change psc to emit ES6 modules instead of CommonJS</a> ES6対応。内部表現に破壊的変更が加わり、一部のFFIが壊れるかも。結局みんな静的解析が欲しくなるんじゃん。Commonjsモジュールとはなんだったのか。</li>
</ul>
<h2>変更履歴</h2>
<p>PureScriptもどんどんバージョンアップしてすぐコンパイル通らなくなって困るのですが、この記事はなるべくメンテナンスしたいと思います。もしこの記事の内容が古くなっていてコンパイルできないようなことがあれば、ご連絡いただけると嬉しいです。この記事のコメント欄でもたぶん気付きますが、<a href="https://twitter.com/cubbit2">ツイッター</a>へご連絡頂いたほうが確実です。</p>
<ul>
<li><strong>2017/06/12</strong> 0.11.5 確認作業。この記事に大きな変更はありません</li>
<li><strong>2017/04/18</strong> 0.11アップデート作業。あとpurescript-halogen-templeteだけ</li>
<li><strong>2017/03/30</strong> 0.11アップデートの注意書きだけ加えました。そのうちまた更新します</li>
<li><strong>2017/01/25</strong> 環境によってコンパイルが通らない問題を修正しました</li>
<li><strong>2017/01/07</strong> 記事のメンテナンスをしました。pscのバージョンは**<a href="https://github.com/purescript/purescript/releases/tag/v0.10.5">v0.10.5</a>**です。バージョンがガンガン上がっていますが、コンパイラに破壊的変更はないので、この記事の内容にも大きな変更はありません。</li>
<li><strong>2016/11/12</strong> 記事のメンテナンスをしました。pscのバージョンは**<a href="https://github.com/purescript/purescript/releases/tag/v0.10.2">v0.10.2</a>**です。node-hhtpモジュールでAPIの変更があった部分を修正しました。</li>
<li>この記事を最初に書いた時点での<code>psc</code>のバージョンは<code>0.9.3</code>でした。</li>
</ul>
<hr />
</div></article></div><footer><div class="sns"><a target="_blank" href="https://twitter.com/intent/tweet?text=%E7%B4%94%E7%B2%8B%E9%96%A2%E6%95%B0%E5%9E%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E8%A8%80%E8%AA%9EPureScript%E3%81%AE%E3%81%AF%E3%81%98%E3%82%81%E3%81%8B%E3%81%9F%E3%80%82%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%81%AE%E4%BD%BF%E3%81%84%E3%81%8B%E3%81%9F%E3%81%8B%E3%82%89%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%2F%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA%E3%81%BE%E3%81%A7%20-%20%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E5%B0%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%AF%E3%81%9F%E3%81%97%E3%81%8B%E3%81%A7%E3%81%99%E3%81%8C%E3%80%82 https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460"><img src="/res/twitter.png" alt="twitter button"></a><a target="brank" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460&amp;t=%E7%B4%94%E7%B2%8B%E9%96%A2%E6%95%B0%E5%9E%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E8%A8%80%E8%AA%9EPureScript%E3%81%AE%E3%81%AF%E3%81%98%E3%82%81%E3%81%8B%E3%81%9F%E3%80%82%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%81%AE%E4%BD%BF%E3%81%84%E3%81%8B%E3%81%9F%E3%81%8B%E3%82%89%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%2F%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA%E3%81%BE%E3%81%A7%20-%20%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E5%B0%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%AF%E3%81%9F%E3%81%97%E3%81%8B%E3%81%A7%E3%81%99%E3%81%8C%E3%80%82"><img src="/res/facebook.png" alt="facebook button"></a><a target="brank" href="https://plus.google.com/share?url=https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460"><img src="/res/google.png" alt="google plus button"></a><a target="brank" href="http://b.hatena.ne.jp/entry/https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460"><img src="/res/hatena.png" alt="hatena bookmark button"></a><a target="brank" href="http://getpocket.com/edit?url=https%3A%2F%2Faratama.github.io%2Fblog%2F2316b58162cfec150460&amp;title=%E7%B4%94%E7%B2%8B%E9%96%A2%E6%95%B0%E5%9E%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E8%A8%80%E8%AA%9EPureScript%E3%81%AE%E3%81%AF%E3%81%98%E3%82%81%E3%81%8B%E3%81%9F%E3%80%82%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%81%AE%E4%BD%BF%E3%81%84%E3%81%8B%E3%81%9F%E3%81%8B%E3%82%89%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%2F%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA%E3%81%BE%E3%81%A7%20-%20%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E5%B0%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%AF%E3%81%9F%E3%81%97%E3%81%8B%E3%81%A7%E3%81%99%E3%81%8C%E3%80%82"><img src="/res/pocket.png" alt="pocket button"></a></div><div class="block-centered footer-inner"><p class="copy">&amp;nbsp;</p><p class="author">このブログを書いてる人: 竹内稲穂</p></div><script>
                    const poem = [
                        "なんにもない毎日が、なによりの宝物。",
                        "今日という日を、何度でも繰り返したい。",
                        "世界を追いかけなくても、世界は私のまわりにある。", 
                        "速すぎる雑踏。鼻先をくすぐる春風。", 
                        "明日撮る写真を飾る場所を、アルバムに空けておこう。", 
                        "落ち葉が地面に、触れる音がした。", 
                        "明日は、明日の楽しさが待っている。", 
                        "風が泣いている。この想いを紡ぐ言葉を持たないから。", 
                        "もうここには何もない。だから、次の場所に旅立とう。", 
                        "もう此処にはこないだろう。そう言って私は過去に背を向けた。", 
                        "散りゆくからこそ、美しい。私は桜の花びらをかかとで踏みしめた。", 
                        "思い出はいつだって輝いてる。",
                        "正直ばかりじゃつまらない。たまには楽しい嘘をつこう。", 
                        "ゆっくり歩けば歩くほど、時間がゆっくり過ぎてゆく。",
                        "夜明けを、探しにいこう。", 
                        "空はこんなに青かったんだ。", 
                        "地球は青かった。それはこの空を見上げたことのある全員が知っている。", 
                        "休み時間は、長すぎるということはない。", 
                        "缶コーヒーを飲むときだけは、それ以外のすべてを忘れることにしてる。", 
                        "ちょっと小さいのは確かですが、それは確かにここにあります。", 
                        "ちょっと小さいのは確かですが、広すぎる家というのも寂しいでしょう？", 
                        "ひつじが一匹、ひつじが二匹。五十匹までは、数えたことがある。"
                    ];
                    document.querySelector(".copy").textContent = poem[Math.floor(poem.length * Math.random())];
                </script></footer></body></html>